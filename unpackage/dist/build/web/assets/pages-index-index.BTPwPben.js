import{r as a,a as e,c as s,w as l,s as t,i as o,o as c,b as r,n,d as u,e as i,f as d,g as v,F as f,t as m,u as _,h as y,j as g,S as p,k as w,l as S,m as b}from"./index-D79phuLK.js";import{_ as q,o as h,r as x,a as E}from"./my-nav.CW2L8Bme.js";import{q as B}from"./request.IyGYDfKt.js";import{g as k,S as N,a as A}from"./system.VgJ8Gk4z.js";const C=q({__name:"index",setup(q){const C=a(k());a(N.screenHeight-A());const D=a(A()+100),I=a(N.screenWidth<600?"90%":N.screenWidth<1500?"600px":"1000px");"phone"===N.deviceType&&console.log("[qwq] device is phone");const L=a("ScoreAsc"),j=a(!0),$=()=>{j.value=!j.value,z()},T=async()=>{try{R.value="bingo_java_run",y({title:"正在加载 Bingo 计分板",icon:"loading",duration:800}),await P(),await z(),y({title:"Bingo 计分板已刷新",icon:"success",duration:800})}catch(a){console.error("刷新计分板失败:",a),t({title:"刷新失败",content:"无法加载 Bingo 计分板，请稍后重试",showCancel:!1})}},V=a(0),F=a([]),R=a(""),W=a([]),K=a([]),Z=a({}),H=a({});async function P(){await B({url:`qs/qwq_scoreboard/${R.value}`}).then((a=>{if(console.log("[qwq] getAllEntriesList(): res.data = "),console.log(a.data),a.data&&a.data.detail&&a.data.detail.includes("Scoreboard file not found"))throw new Error("计分板文件未找到");if(!a.data||!a.data.scoreboard_data||!Array.isArray(a.data.scoreboard_data))throw new Error("服务器返回的数据格式无效");W.value=a.data.scoreboard_data})).catch((a=>{throw console.error("获取计分板数据失败:",a),W.value=[],a}))}async function z(){K.value=[],K.value=function(a,e){if(!a||!Array.isArray(a))return console.warn("sortEntriesList: entries is not a valid array",a),[];return a.sort(((a,s)=>"NameAsc"===e?a.name.localeCompare(s.name):"NameDesc"===e?s.name.localeCompare(a.name):"ScoreAsc"===e?a.score-s.score:"ScoreDesc"===e?s.score-a.score:0))}(W.value,L.value),j.value&&(K.value=K.value.filter((a=>0!==a.score))),Z.value={},H.value={},K.value.forEach((a=>{a.avatar_url=`https://us-cc.vincentzyu233.cn/fastapi_wrap/mcjava/avatar/${a.name}`,Z.value[a.name]=!1,H.value[a.name]=!1})),console.log("reloadDisplayEntriesList(): displayEntriesList.value = "),console.log(K.value)}async function J(){try{await async function(){await B({url:"qs/qwq_scoreboard_list"}).then((a=>{console.log("[qwq] getScoreboardNamesList(): res.data = "),console.log(a.data),a.data&&0!=a.data.length?(y({title:"[qwq]获取计分板名称",icon:"success",duration:999}),F.value=a.data.scoreboard_name_list,R.value=F.value[0],setTimeout((()=>{y({title:`[qwq]设置默认显示计分板：...List[0] = ${R.value}`,icon:"success",duration:999})}),1999)):t({title:"[qwq]网络请求发生错误,请将此页面截图,并联系开发人员VincentZyu",content:"getScoreboardNamesList()获取计分板名称失败，要么没拿到，要么数组长度是0",showCancel:!1})}))}(),await P(),await z()}catch(a){t({title:"[qwq]网络请求发生错误,请将此页面截图,并联系开发人员VincentZyu",content:`onLoad()回调函数里面发生了未知错误, err = ${a}`,showCancel:!1})}}h((()=>{J()}));const O=a(Number(1));return h((a=>{O.value=a.LastIdx?Number(a.LastIdx):1})),(a,t)=>{const q=o,h=g,B=p,k=w,W=b,J=x(e("my-nav"),E);return c(),s(q,{class:"PageRoot"},{default:l((()=>[r(q,{class:"WorksPage pageBg"}),r(q,{class:"SortRulesContainer",style:i({top:C.value+"px"})},{default:l((()=>[r(h,{class:n(["SortButton","NameAsc"==L.value?"active":""]),onClick:t[0]||(t[0]=a=>(L.value="NameAsc",console.log("按名字升序排序"),void z()))},{default:l((()=>[u("名字升序")])),_:1},8,["class"]),r(h,{class:n(["SortButton","NameDesc"==L.value?"active":""]),onClick:t[1]||(t[1]=a=>(L.value="NameDesc",console.log("按名字降序排序"),void z()))},{default:l((()=>[u("名字降序")])),_:1},8,["class"]),r(h,{class:n(["SortButton","ScoreAsc"==L.value?"active":""]),onClick:t[2]||(t[2]=a=>(L.value="ScoreAsc",console.log("按分数升序排序"),void z()))},{default:l((()=>[u("分数升序")])),_:1},8,["class"]),r(h,{class:n(["SortButton","ScoreDesc"==L.value?"active":""]),onClick:t[3]||(t[3]=a=>(L.value="ScoreDesc",console.log("按分数降序排序"),void z()))},{default:l((()=>[u("分数降序")])),_:1},8,["class"])])),_:1},8,["style"]),r(B,{class:"ScoeboardNamesScrollBox","scroll-x":"",style:i({height:D.value+"px"})},{default:l((()=>[(c(!0),d(f,null,v(F.value,((a,e)=>(c(),s(q,{class:n(["ScoreboardOutBox",V.value==e?"active":""]),key:e,onClick:a=>(async a=>{console.log(`[qwq]changeActive(): 现在活跃的idx = ${a}`),V.value=a,R.value=F.value[a],await P(),await z(),y({title:`[qwq]切换展示计分板: ${R.value}`,icon:"success",duration:450})})(e),style:i({top:_(A)()+"px"})},{default:l((()=>[r(q,{class:"ScoreboardNameBox"},{default:l((()=>[r(q,{class:"ScoreboardNameText"},{default:l((()=>[u(m(a),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick","style"])))),128))])),_:1},8,["style"]),r(B,{"scroll-y":"",class:"ScoreboardEntriesScrollBox"},{default:l((()=>[r(q,{class:"ScoreboardContent",style:i({paddingTop:D.value+"px",width:I.value})},{default:l((()=>[r(q,{class:"FilterBox"},{default:l((()=>[r(k,null,{default:l((()=>[u(" ↓ Java跑酷: Hielke地图 计分板 ↓")])),_:1}),r(q,{class:"FilterButtons"},{default:l((()=>[r(h,{class:"ExcludeZeroButton",onClick:$},{default:l((()=>[u(" 排除0分数: "+m(j.value),1)])),_:1}),r(h,{class:"RefreshButton",onClick:T},{default:l((()=>[u("刷新")])),_:1})])),_:1})])),_:1}),(c(!0),d(f,null,v(K.value,((a,e)=>(c(),s(q,{class:"EntryItem",key:a.avatar_url},{default:l((()=>[r(q,{class:"EntryBox"},{default:l((()=>[r(q,{class:"EntryImageWrapper"},{default:l((()=>[r(W,{class:"EntryImage",src:a.avatar_url,mode:"aspectFill",onLoad:e=>{return s=a.name,Z.value[s]=!0,void(H.value[s]=!1);var s},onError:e=>{return s=a.name,Z.value[s]=!1,void(H.value[s]=!0);var s}},null,8,["src","onLoad","onError"]),Z.value[a.name]||H.value[a.name]?S("",!0):(c(),s(q,{key:0,class:"AvatarSpinner"},{default:l((()=>[r(q,{class:"SpinnerSmall"})])),_:1})),H.value[a.name]?(c(),s(q,{key:1,class:"AvatarError"},{default:l((()=>[u("?")])),_:1})):S("",!0)])),_:2},1024),r(q,{class:"EntryName"},{default:l((()=>[r(q,{class:"EntryKey"},{default:l((()=>[u("Name:")])),_:1}),r(q,{class:"EntryValue"},{default:l((()=>[u(m(a.name),1)])),_:2},1024),r(q,{class:"EntryKey"},{default:l((()=>[u("Score:")])),_:1}),r(q,{class:"EntryValue"},{default:l((()=>[u(m(a.score),1)])),_:2},1024)])),_:2},1024),r(q,{class:"EntryRank"},{default:l((()=>[u(m((e+1).toString().padStart(2,"0")),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["style"])])),_:1}),r(q,{class:"DebugInfoBox"},{default:l((()=>[r(q,{class:"DebugInfoTitle"},{default:l((()=>[u(" DebugInfo: ")])),_:1}),(c(!0),d(f,null,v(_(N),((a,e)=>(c(),s(q,{class:"DebugInfoItem",key:e},{default:l((()=>[r(q,{class:"DebugInfoKey"},{default:l((()=>[u(m(e),1)])),_:2},1024),r(q,{class:"DebugInfoValue"},{default:l((()=>[u(m(_(N)[e]),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),r(J,{class:"down-nav",y:Number(1),x:O.value},null,8,["y","x"])])),_:1})}}},[["__scopeId","data-v-d98b3e4d"]]);export{C as default};
