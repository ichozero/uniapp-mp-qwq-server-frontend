import{r as a,a as e,c as l,w as t,s,i as o,o as r,b as c,n,d as u,e as i,l as d,f as v,g as f,F as m,j as g,k as _,I as h,S as y,t as p,m as S}from"./index-D79phuLK.js";import{_ as D,o as L,r as w,a as C}from"./my-nav.CW2L8Bme.js";import{q as A}from"./request.IyGYDfKt.js";import{g as x,S as k,a as q}from"./system.VgJ8Gk4z.js";const R=D({__name:"authme",setup(D){const R=a(x());a(k.screenHeight-q());const B=a(k.screenWidth<600||k.screenWidth<1500?"calc(100% - 40px)":"calc(100% - 80px)");"phone"===k.deviceType&&console.log("[qwq] device is phone");const I=a("RegDateAsc"),P=a(!1),N=a(!1),b=a([]),j=a([]),T=a({}),H=a({}),V=a("");async function E(){P.value=!0;try{await A({url:"qs/qwq_authme_data",isShowToast:!0,loadingText:"è·å–ç©å®¶æ•°æ®ä¸­...",completeText:"æ•°æ®è·å–æˆåŠŸ"}).then((a=>{if(console.log("[qwq] getPlayerData(): res.data = "),console.log(a.data),!a.data||!Array.isArray(a.data))return console.warn("[qwq] getPlayerData returned no array"),N.value=!0,b.value=[],void(j.value=[]);N.value=!1,T.value={},H.value={},b.value=a.data,F()}))}catch(a){console.error("è·å–ç©å®¶æ•°æ®å¤±è´¥:",a),s({title:"[qwq]ç½‘ç»œè¯·æ±‚å‘ç”Ÿé”™è¯¯",content:`è·å–ç©å®¶æ•°æ®å¤±è´¥: ${a.message||a}`,showCancel:!1}),N.value=!0}finally{P.value=!1}}function F(){let a=b.value;var e,l;V.value.trim()&&(a=function(a,e){if(!e)return a;const l=e.toLowerCase();function t(a,e){const l=a.toLowerCase(),t=e.toLowerCase();if(l.includes(t)||t.includes(l))return 1;const o=1-s(l,t)/Math.max(l.length,t.length);return l.charAt(0)===t.charAt(0)?1.2*o:o}function s(a,e){const l=[],t=a.length,s=e.length;for(let o=0;o<=t;o++)l[o]=[o];for(let o=0;o<=s;o++)l[0][o]=o;for(let o=1;o<=t;o++)for(let t=1;t<=s;t++)a.charAt(o-1)===e.charAt(t-1)?l[o][t]=l[o-1][t-1]:l[o][t]=Math.min(l[o-1][t-1]+1,l[o][t-1]+1,l[o-1][t]+1);return l[t][s]}return a.map((a=>({...a,_searchScore:t(a.realname,l)}))).filter((a=>a._searchScore>=.3)).sort(((a,e)=>e._searchScore-a._searchScore)).map((a=>{const{_searchScore:e,...l}=a;return l}))}(b.value,V.value.trim())),j.value=(e=a,l=I.value,[...e].sort(((a,e)=>"NameAsc"===l?a.realname.localeCompare(e.realname):"NameDesc"===l?e.realname.localeCompare(a.realname):"RegDateAsc"===l?a.regdate-e.regdate:"RegDateDesc"===l?e.regdate-a.regdate:"LastLoginAsc"===l?a.lastlogin-e.lastlogin:"LastLoginDesc"===l?e.lastlogin-a.lastlogin:0)))}function W(){W.timeoutId&&clearTimeout(W.timeoutId),W.timeoutId=setTimeout((()=>{F()}),300)}function M(a){if(!a)return"æœªçŸ¥";return new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}const O=()=>{E()};L((()=>{!async function(){try{await E()}catch(a){s({title:"[qwq]åˆå§‹åŒ–é¡µé¢å‘ç”Ÿé”™è¯¯",content:`onLoad()å›è°ƒå‡½æ•°é‡Œé¢å‘ç”Ÿäº†æœªçŸ¥é”™è¯¯, err = ${a}`,showCancel:!1})}}()}));const $=a(Number(2));return L((a=>{$.value=a.LastIdx?Number(a.LastIdx):2})),(a,s)=>{const D=o,L=g,A=_,x=h,k=S,q=y,b=w(e("my-nav"),C);return r(),l(D,{class:"PageContainer"},{default:t((()=>[c(D,{class:"WorksPage pageBg"}),c(D,{class:"SortRulesContainer",style:i({top:R.value+6+"px",left:"10px",right:"10px"})},{default:t((()=>[c(D,{class:"SortRow"},{default:t((()=>[c(L,{class:n(["SortButton","NameAsc"==I.value?"active":""]),onClick:s[0]||(s[0]=a=>(I.value="NameAsc",console.log("æŒ‰åå­—å‡åºæ’åº"),void F()))},{default:t((()=>[u("åå­—å‡åº")])),_:1},8,["class"]),c(L,{class:n(["SortButton","NameDesc"==I.value?"active":""]),onClick:s[1]||(s[1]=a=>(I.value="NameDesc",console.log("æŒ‰åå­—é™åºæ’åº"),void F()))},{default:t((()=>[u("åå­—é™åº")])),_:1},8,["class"])])),_:1}),c(D,{class:"SortRow"},{default:t((()=>[c(L,{class:n(["SortButton","RegDateAsc"==I.value?"active":""]),onClick:s[2]||(s[2]=a=>(I.value="RegDateAsc",console.log("æŒ‰æ³¨å†Œæ—¶é—´å‡åºæ’åº"),void F()))},{default:t((()=>[u("æ³¨å†Œæ—¶é—´å‡åº")])),_:1},8,["class"]),c(L,{class:n(["SortButton","RegDateDesc"==I.value?"active":""]),onClick:s[3]||(s[3]=a=>(I.value="RegDateDesc",console.log("æŒ‰æ³¨å†Œæ—¶é—´é™åºæ’åº"),void F()))},{default:t((()=>[u("æ³¨å†Œæ—¶é—´é™åº")])),_:1},8,["class"])])),_:1}),c(D,{class:"SortRow"},{default:t((()=>[c(L,{class:n(["SortButton","LastLoginAsc"==I.value?"active":""]),onClick:s[4]||(s[4]=a=>(I.value="LastLoginAsc",console.log("æŒ‰æœ€åç™»å½•æ—¶é—´å‡åºæ’åº"),void F()))},{default:t((()=>[u("æœ€åç™»å½•å‡åº")])),_:1},8,["class"]),c(L,{class:n(["SortButton","LastLoginDesc"==I.value?"active":""]),onClick:s[5]||(s[5]=a=>(I.value="LastLoginDesc",console.log("æŒ‰æœ€åç™»å½•æ—¶é—´é™åºæ’åº"),void F()))},{default:t((()=>[u("æœ€åç™»å½•é™åº")])),_:1},8,["class"])])),_:1})])),_:1},8,["style"]),c(q,{"scroll-y":"",class:"PlayerDataScrollBox"},{default:t((()=>[c(D,{class:"PlayerDataContent",style:i({width:B.value})},{default:t((()=>[c(D,{class:"HeaderBox"},{default:t((()=>[c(A,{class:"HeaderTitle"},{default:t((()=>[u("â†“ AuthMe ç©å®¶æ•°æ® â†“")])),_:1}),c(A,{class:"HeaderSubtitle"},{default:t((()=>[u("ç©å®¶æ³¨å†Œä¿¡æ¯ä¸æœ€åç™»å½•æ—¶é—´ç»Ÿè®¡")])),_:1}),c(D,{class:"SearchContainer"},{default:t((()=>[c(x,{class:"SearchInput",modelValue:V.value,"onUpdate:modelValue":s[6]||(s[6]=a=>V.value=a),placeholder:"æ¨¡ç³Šæœç´¢ç©å®¶å...",onInput:W,focus:!1},null,8,["modelValue"]),c(D,{class:"SearchIcon"},{default:t((()=>[u("ğŸ”")])),_:1})])),_:1}),c(L,{class:"RefreshButton",onClick:O},{default:t((()=>[u("åˆ·æ–°æ•°æ®")])),_:1})])),_:1}),P.value||N.value?(r(),l(D,{key:0,class:"LoadingOverlay"},{default:t((()=>[P.value?(r(),l(D,{key:0,class:"SpinnerLarge"})):(r(),l(D,{key:1,class:"FetchFailedBox"},{default:t((()=>[c(D,{class:"SpinnerLarge"}),c(A,{class:"failText"},{default:t((()=>[u("æœªèƒ½ä»æœåŠ¡å™¨å–å¾—æ•°æ®")])),_:1}),c(L,{class:"RefreshButton",onClick:O},{default:t((()=>[u("é‡è¯•")])),_:1})])),_:1}))])),_:1})):d("",!0),P.value||N.value||0!==j.value.length?d("",!0):(r(),l(D,{key:1,class:"EmptyBox"},{default:t((()=>[c(A,null,{default:t((()=>[u("æš‚æ— æ•°æ®")])),_:1})])),_:1})),(r(!0),v(m,null,f(j.value,((a,e)=>(r(),l(D,{class:"PlayerCard",key:a.realname},{default:t((()=>[c(D,{class:"PlayerCardHeader"},{default:t((()=>[c(D,{class:"AvatarWrapper"},{default:t((()=>[c(k,{class:"PlayerAvatar",src:`https://us-cc.vincentzyu233.cn/fastapi_wrap/mcjava/avatar/${a.realname}`,mode:"aspectFit",onLoad:e=>{return l=a.realname,void(T.value=Object.assign({},T.value,{[l]:!0}));var l},onError:e=>{return l=a.realname,void(H.value=Object.assign({},H.value,{[l]:!0}));var l}},null,8,["src","onLoad","onError"]),T.value[a.realname]||H.value[a.realname]?d("",!0):(r(),l(D,{key:0,class:"AvatarSpinner"},{default:t((()=>[c(D,{class:"SpinnerSmall"})])),_:1})),H.value[a.realname]?(r(),l(D,{key:1,class:"AvatarError"},{default:t((()=>[u("?")])),_:1})):d("",!0)])),_:2},1024),c(D,{class:"PlayerInfo"},{default:t((()=>[c(A,{class:"PlayerName"},{default:t((()=>[u(p(a.realname),1)])),_:2},1024),c(A,{class:"PlayerRank"},{default:t((()=>[u("#"+p((e+1).toString().padStart(2,"0")),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),c(D,{class:"PlayerDetails"},{default:t((()=>[c(D,{class:"DetailItem"},{default:t((()=>[c(A,{class:"DetailLabel"},{default:t((()=>[u("æ³¨å†Œæ—¶é—´:")])),_:1}),c(A,{class:"DetailValue"},{default:t((()=>[u(p(M(a.regdate)),1)])),_:2},1024)])),_:2},1024),c(D,{class:"DetailItem"},{default:t((()=>[c(A,{class:"DetailLabel"},{default:t((()=>[u("æœ€åç™»å½•:")])),_:1}),c(A,{class:"DetailValue"},{default:t((()=>[u(p(M(a.lastlogin)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["style"])])),_:1}),c(b,{class:"down-nav",y:Number(2),x:$.value},null,8,["y","x"])])),_:1})}}},[["__scopeId","data-v-dd99d914"]]);export{R as default};
